<header class="flex items-center justify-between pb-6 border-b border-gray-200 mb-6">
    <div class="flex items-center">
        <button id="sidebar-toggle" class="mr-4 p-2 rounded-full hover:bg-gray-200 text-gray-600 transition">
            <i data-lucide="menu" class="w-6 h-6"></i>
        </button>
        <h1 id="order-header" class="text-3xl font-bold text-gray-800">Cargando...</h1>
    </div>
    <span class="text-sm text-gray-500">Módulo: Cotizaciones / OT</span>
</header>

<form id="order-form" class="bg-white shadow-xl rounded-xl p-8 hidden"> 
    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8 border-b pb-6">
        
        <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Código Cotización</label>
            <p id="display-code" class="font-mono text-lg text-gray-900 border p-2 rounded-lg bg-gray-50">-</p>
        </div>
        <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">ID Orden de Trabajo (OT)</label>
            <p id="display-ot-id" class="font-mono text-lg text-red-600 border p-2 rounded-lg bg-gray-50">-</p>
        </div>
        
        <div class="relative group">
            <label for="client-search" class="block text-sm font-medium text-gray-700 mb-1">Cliente <span class="text-red-500">*</span></label>
            
            <div class="relative">
                <input type="text" id="client-search" autocomplete="off" placeholder="Seleccione o busque cliente..." 
                    class="form-input w-full pl-3 pr-10 py-2 border border-gray-300 rounded-lg shadow-sm focus:ring-red-500 focus:border-red-500 transition cursor-pointer">
                
                <div id="client-search-icon" class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 pointer-events-none">
                    <i data-lucide="chevron-down" class="w-5 h-5"></i>
                </div>
                <div id="client-loading-icon" class="absolute right-3 top-1/2 transform -translate-y-1/2 text-red-500 hidden animate-spin">
                    <i data-lucide="loader-2" class="w-5 h-5"></i>
                </div>
            </div>

            <input type="hidden" id="client-id-hidden" required>

            <div id="client-results-dropdown" class="absolute z-50 w-full bg-white mt-1 border border-gray-200 rounded-lg shadow-xl hidden max-h-60 overflow-y-auto">
                </div>
        </div>    
        
        <div class="md:col-span-3">
            <label for="notas_internas" class="block text-sm font-medium text-gray-700 mb-1">Notas Internas</label>
            <textarea id="notas_internas" rows="2" class="form-input w-full px-3 py-2 border border-gray-300 rounded-lg shadow-sm"></textarea>
        </div>
    </div>

    <h2 class="text-2xl font-bold text-gray-800 mb-4 flex justify-between items-center">
        Líneas de Producto
        <button type="button" id="btn-add-line" class="px-3 py-1 bg-green-500 text-white font-semibold rounded-lg shadow-md hover:bg-green-600 transition text-sm">
            <i data-lucide="plus" class="w-4 h-4 inline mr-1"></i> Agregar Línea
        </button>
    </h2>

    <div class="overflow-x-auto">
        <table class="min-w-full divide-y divide-gray-200">
            <thead class="bg-gray-200">
                <tr>
                    <th class="px-3 py-3 text-left w-1/4">Producto</th>
                    <th class="px-3 py-3 text-left w-1/12">Cant.</th>
                    <th class="px-3 py-3 text-left w-1/3">Especificaciones</th>
                    <th class="px-3 py-3 text-right w-1/6">P. Unitario</th>
                    <th class="px-3 py-3 text-right w-1/6">Subtotal</th>
                    <th class="px-3 py-3 text-center"></th>
                </tr>
            </thead>
            <tbody id="product-lines-container" class="bg-white divide-y divide-gray-200"></tbody>
            <tfoot>
                <tr class="bg-gray-100 font-bold text-lg">
                    <td colspan="4" class="px-3 py-3 text-right text-gray-800">TOTAL:</td>
                    <td id="display-total" class="px-3 py-3 text-right text-red-700">S/ 0.00</td>
                    <td></td>
                </tr>
            </tfoot>
        </table>
    </div>

    <div class="mt-10 pt-6 border-t border-gray-200 flex flex-col md:flex-row justify-between space-y-4 md:space-y-0">
        
        <div id="edit-actions" class="flex space-x-4 hidden">
            <button type="submit" id="btn-save-quote" class="px-6 py-3 color-primary-red text-white font-semibold rounded-lg shadow-md hover:bg-red-700 transition">
                <i data-lucide="save" class="w-5 h-5 inline mr-2"></i> Guardar
            </button>
            <button type="button" id="btn-cancel-nav" class="px-6 py-3 bg-gray-400 text-white font-semibold rounded-lg shadow-md hover:bg-gray-500 transition">
                <i data-lucide="arrow-left" class="w-5 h-5 inline mr-2"></i> Cancelar
            </button>
        </div>

        <div id="view-actions" class="flex space-x-4 hidden">
            <button type="button" id="btn-convert-ot" class="px-6 py-3 btn-accent text-white font-semibold rounded-lg shadow-md transition">
                <i data-lucide="zap" class="w-5 h-5 inline mr-2"></i> Convertir a OT
            </button>
            <button type="button" id="btn-reject-quote" class="px-6 py-3 bg-red-800 text-white font-semibold rounded-lg shadow-md hover:bg-red-900 transition">
                <i data-lucide="x-octagon" class="w-5 h-5 inline mr-2"></i> Rechazar
            </button>
        </div>

        <div id="ot-actions" class="hidden">
             <button type="button" id="btn-generate-invoice" class="px-6 py-3 btn-critical text-white font-semibold rounded-lg shadow-md transition disabled:opacity-50" disabled>
                <i data-lucide="receipt-text" class="w-5 h-5 inline mr-2"></i> Generar Factura
            </button>
        </div>
    </div>
</form>

<div id="invoice-modal-content" class="hidden">
    <div class="relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-xl bg-white">
        <h3 class="text-xl font-bold mb-4 text-red-600">Emisión de Comprobante</h3>
        <p class="text-gray-600 mb-6">Seleccione el tipo de documento.</p>
        <div class="space-y-4 mb-6">
            <label class="block p-3 border rounded hover:bg-gray-50 cursor-pointer">
                <input type="radio" name="doc_type" value="FACTURA" class="mr-2" checked> Factura Electrónica
            </label>
            <label class="block p-3 border rounded hover:bg-gray-50 cursor-pointer">
                <input type="radio" name="doc_type" value="BOLETA" class="mr-2"> Boleta de Venta
            </label>
        </div>
        <div class="flex justify-end space-x-3">
            <button type="button" onclick="window.UI.hideModal('invoice-modal-container')" class="px-4 py-2 bg-gray-300 rounded-lg">Cancelar</button>
            <button onclick="window.UI.hideModal('invoice-modal-container'); window.UI.showNotification('Facturado', 'Documento enviado a SUNAT.')" class="px-4 py-2 color-primary-red text-white rounded-lg">Emitir</button>
        </div>
    </div>
</div>